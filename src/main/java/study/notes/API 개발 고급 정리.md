# 📌정리

- 엔티티 조회
  - 엔티티 스펙이 변하면 api 스펙 자체가 변하므로 엔티티 자체 사용은 하지 말아야한다.
  - 엔티티 -> dto로 적절히 변환해서 사용해라.
  - 성능 최적화를 위해서 페치 조인 사용해라.(쿼리 수 최적화)
  - 컬렉션에서 페치 조인은 페이징 불가
    - ToOne 관계는 페치 조인으로 쿼리 수 최적화
    - 컬렉션은 페치 조인 사용하지 말고, 지연로딩으로 유지하고 batchSize 로 설정해라.(batchSize 설정만큼 한번에 쿼리 조회)
    
- DTO 직접 조회
  - JPA에서 DTO로 직접조회
  - 컬렉션 조회 최적화 : 일대다 관계인 컬렉션은 IN절을 활용해서 메모리에서 미리 조회해서 최적화
  - 플랫 데이터 최적화 : JOIN 결과를 그대로 조회 후 애플리케이션에서 원하는 모양으로 직접 변환

⭐권장 순서
1. 엔티티 조회 방식으로 우선 접근
   1. 페치 조인으로 쿼리 수 최적화
   2. 컬렉션 최적화 :  페이징 필요하면 지연로딩으로 유지하고 n+1 문제해결을 위해 batchSize 설정으로 최적화한다.
   페이징 필요 없다면 페치 조인 사용해도됨.
   
2. 엔티티 조회 방식으로 해결 안되면 DTO 직접 조회 방식 사용
3. DTO 조회 방식으로 해결이 안되면 NativeSQL OR 스프링 jdbc Templet활용

